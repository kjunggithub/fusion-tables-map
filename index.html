<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	
	<!-- styles -->
	<style type="text/css">
		#map_canvas {
			width:100%;
		  	height:300px;
		}
	</style>
</head>
<body>
	<!-- html -->
	<h1>Address!</h1>
	<input type="text" class="address" value="">
	<input type="button" class="js-address-button" value="Address Go!">

	<h1>Geolocation</h1>
	<input type="button" class="js-geolocation-button" value="Getolocation Go!">

	<h1>Map!</h1>
	<div id="map_canvas">
		
	</div>

	<!-- javascript -->
	<script type="text/javascript">

		function getMap(latitude, longitude) {
			var tableId = '1fa2D62r4NYCz6apCnH4hzpEdTUjOubmHi5LeUlXM';
			var locationColumn = 'Address';

			var location = new google.maps.LatLng(latitude, longitude);
			var mapOptions = {
				zoom: 10,
				center: location,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};

			// create the map
			var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

			// place current location marker
			var marker = new google.maps.Marker({
			    position: location,
			    title: 'Your Location',
			    map: map
			});

			// load the fusion table data on to the map
			var layer = new google.maps.FusionTablesLayer({
			  query: {
			    select: locationColumn,
			    from: tableId,
			    orderBy: 'ST_DISTANCE(' +  locationColumn + ', LATLNG(' +  latitude + ',' + longitude + '))',
			    limit: 3
			  },
			  map: map
			});
		}

		function getAddressGeocode() {
			// geocoder instance
			var geocoder = new google.maps.Geocoder();

			// get address input value
			var address = $('.address').val();
			geocoder.geocode(
				// pass address
				{ address: address },

				// pass callback closure
				function(results, status) {

					// if result found, alert it
					if (google.maps.GeocoderStatus.OK === status) {
						var userLocation = results[0].geometry.location;
						alert(userLocation);
						return userLocation;

						// if there is an error, show error
					} else {
	              		window.alert('Address could not be geocoded: ' + status);
	        		}
				}
			);
		}

		//Get the latitude and the longitude;
		function success(position) {
			latitude = position.coords.latitude;
			longitude = position.coords.longitude;

			getMap(latitude, longitude);
		}

		function error(errorCode) {
			alert("Geocoder failed " + errorCode.message);
		}

		function getGeolocation() {
			if ("geolocation" in navigator) {
				navigator.geolocation.getCurrentPosition(success, error);
			}
		}

		// on click of the address button
		$('.js-address-button').on('click', function(e) {
			e.preventDefault();

			getAddressGeocode();
			getMap(latitude, longitude);
		});

		// on click of the geol
		$('.js-geolocation-button').on('click', function(e) {
			e.preventDefault();

			getGeolocation();
		});
	</script>
</body>
</html>